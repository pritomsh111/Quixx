<!DOCTYPE html>
<style>
div.hideKoro2{
	display:none;
}
table#dtBasicExample.dataTable tbody tr:hover {
	background-color: #FFFFEA;
    border-color: #0066b3; 
}

table#dtBasicExample.dataTable tbody tr:hover > .sorting_1 {
	background-color: #FFFFEA;
    border-color: #0066b3;
}
table#dtBasicExampleAp.dataTable tbody tr:hover {
	background-color: #FFFFEA;
    border-color: #0066b3;
}

table#dtBasicExampleAp.dataTable tbody tr:hover > .sorting_1 {
	background-color: #FFFFEA;
    border-color: #0066b3;
}
.naV{
 background:#ffcf5c;
}
.row {
  display: flex;
}
.col-md-4 {
  flex-grow: 1;
  text-align: center;
}
.cool-link {
    display: inline-block;
    color: #000;
    text-decoration: none;
}
.card.x{
    margin-top: -0.1rem;
  }
  
.row.navBtn {
  position: relative;
  overflow-x: unset;
  width: 100%;
  padding-left: 0.9rem;
  align-items: center;
  gap: 0.2rem;
  z-index: 1;
  margin-bottom: 0.2rem;
}

.row.navBtn button {
  padding: 0.4rem;
}
</style>
<div id="loaderMama2" style="margin-top:8%;">
    <div class="multi-spinner-container" style="color:#fff">
        <div class="multi-spinner">
            <div class="multi-spinner">
                <div class="multi-spinner">
                    <div class="multi-spinner">
                        <div class="multi-spinner">
                            <div class="multi-spinner"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <h3 style=" font-family: 'Didact Gothic';font-size: 24px;text-align:center;color:#0066b3">Please Wait...</h3>
</div>
<div class="card naV hideKoro2" id="hideKoro2">
    <div class="card-body table-responsive">
        <div class="row navBtn">
            <button
                class="btn-outline btn-round btn-default btn btn-info"
                id="twoa"
                style="font-size: 13px"
                onclick="approvedMer()"
            >Approved Merchants</button>
            <button
                class="btn-outline btn-round btn-default btn btn-info"
                id="threea"
                style="font-size: 13px"
                onclick="unApprovedMer()"
            >Unapproved Merchants</button>
        </div>
    </div>
    <div class="card a x">
        <div class="card-body table-responsive a">
            <table
                id="dtBasicExample"
                class="stripe hover"
                style="color:#0066b3;"
                cellspacing="0"
                width="100%"
            >
                <thead>
                    <tr>
                        <th class="th-sm">
                            Organization Name
                        </th>
                        <th class="th-sm">
                            ID
                        </th>
                        <th class="th-sm">
                            Company Name
                        </th>
                        <th class="th-sm">
                            Owner
                        </th>
                        <th class="th-sm">
                            Email
                        </th>
                        <th class="th-sm">
                            Phone Number
                        </th>
                        <th class="th-sm">
                            Enable Email Notification
                        </th>
                        <th class="th-sm">
                            Disable Email Notification
                        </th>
                    </tr>
                </thead>
            </table>
        </div>
    </div>
    <div class="card b x">
        <div class="card-body table-responsive b blur">
            <table
                id="dtBasicExampleAp"
                class="stripe hover"
                style="color:#0066b3;"
                cellspacing="0"
                width="100%"
            >
                <thead>
                    <tr>
                        <th class="th-sm">
                            Organization Name
                        </th>
                        <th class="th-sm">
                            ID
                        </th>
                        <th class="th-sm">
                            Company Name
                        </th>
                        <th class="th-sm">
                            Owner
                        </th>
                        <th class="th-sm">
                            Email
                        </th>
                        <th class="th-sm">
                            Phone Number
                        </th>
                        <th class="th-sm">
                            Business Field
                        </th>
                        <th class="th-sm">
                            Per Delivery Cost
                        </th>
                        <th class="th-sm">
                            Approve?
                        </th>
                    </tr>
                </thead>
            </table>
        </div>
    </div>
</div>
<div
    class="modal fade"
    id="myModal"
    tabindex="-1"
    role="dialog"
    aria-labelledby="myModalLabel"
    aria-hidden="true"
    data-backdrop="static"
>
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button
                    type="button"
                    class="close"
                    data-dismiss="modal"
                    aria-hidden="true"
                ></button>
                <h4 class="modal-title" id="myModalLabel" style="color:#0066b3">Approve this merchant?</h4>
            </div>
            <div class="modal-body" style="text-align:center">
                <div class="circle-loader" style="text-align:center">
                    <div class="checkmark draw" id="tick"></div>
                </div>
                <h4 id="sure" style="color:#0066b3"></h4>
            </div>
            <div class="modal-footer">
                <button
                    type="button"
                    style="color:#0066b3"
                    class="btn btn-outline btn-default"
                    id="modalCancel"
                    data-dismiss="modal"
                >Cancel</button>
                <button
                    type="button"
                    style="color:#0066b3"
                    class="btn btn-outline btn-danger btn-ok"
                    id="modalApprove"
                >Approve</button>
            </div>
        </div>
    </div>
</div>
<div id="myModal2" class="modal fade" data-backdrop="static">
    <div class="modal-dialog modal-confirm">
        <div class="modal-content">
            <div class="modal-body text-center">
                <h4 style="color:#0066b3">Ooops!</h4>
                <p style="color:#0066b3"> Something went wrong. Please try again!</p>
                <button class="btn btn-outline btn-danger btn-error" style="color:#0066b3" data-dismiss="modal">Try Again</button>
            </div>
        </div>
    </div>
</div>
<script>
function one1(){
	setTimeout(function() { $('#loaderMama2').fadeOut(); }, 2100);
}
function two2(){
	setTimeout(function() { $('div#hideKoro2').removeClass("hidden");$('#hideKoro2').fadeIn(); }, 2700);
}
function three3(){
	setTimeout(function() {
		document.getElementById('twoa').disabled = true;
		document.getElementById('threea').disabled = false;
		document.getElementById('twoa').style.fontSize = '14.5px';
		document.getElementById('threea').style.fontSize = '13px';
		$('#dtBasicExampleAp').hide();
		$('.b').hide();
		var table = $('#dtBasicExample').DataTable( {
			"processing": true,
			"destroy": true,
			"oSearch": { "bSmart": false, "bRegex": true }
			} );
			table.clear().draw();
		$.ajax
			({
				async: true,
				type: "GET",
				url: urlForAll + "approved/merchant/approved",
				headers: 
				{
				  'Accept': 'application/json',
				  'Content-Type': 'application/json',
				"Authorization": 'Bearer ' + localStorage.getItem('token')
				},
				success: function(data) 
				{
					document.getElementById('twoa').innerHTML = 'Approved Merchants: ' + data.data.length;
					document.getElementById('threea').innerHTML = 'Unapproved Merchants';
					var trHTML = '';
					$.each(data.data, function (i, item) {
					var table_rows = '<tr><td>'
					+data.data[i].root_org_name+'</td><td>'
					+data.data[i].merchant_id+'</td><td>'
					+data.data[i].org_name+'</td><td>'
					+data.data[i].person_name+'</td><td>'
					+data.data[i].email+'</td><td>'
					+data.data[i].phone_number+'</td><td>'
					+'<button id="' + data.data[i].merchant_id + '" class="btn-round btn-outline btn enableEmail" style="font-size:13px">Enable</button>' + "</td><td>"
					+'<button id="' + data.data[i].merchant_id + '" class="btn-round btn-outline btn disableEmail" style="font-size:13px">Disable</button>' + "</td></tr>";

					table.rows.add($(table_rows)).draw();
					});
				},
				error: function(XMLHttpRequest, textStatus, errorThrown) {
					alert("Please wait, we are working!");
				}
			})
		$('.dataTables_filter input[type="search"]').
		attr('placeholder','Search anything!').
		css({'width':'220px','display':'inline-block','background':'white'});

		$('.dataTables_filter input[type="search"]').
		attr('class','btn btn-round').
		css({'width':'220px','display':'inline-block','color':'#000000','background':'#FFFFFA'});

		$('.dataTables_length select').
		attr('class','btn btn-round').
		css({'width':'80px','background-color':'white','color':'#000000','background':'#FFFFFA'});

		$('#dtBasicExample').show();
		$('.a').show();
	}, 3600);
}
</script>
<script>

$(document).ready(function() {
	$('#loaderMama2').show();
	one1();
	two2();
	//$("#hideKoro").hide();
	$(".container").hide();
	$('#dtBasicExample').hide();
	$('.a').hide();
	$('.b').hide();
	$.fn.dataTable.ext.classes.sPageButton = 'btn btn-outline btn-round'; // Change Pagination Button Class
	three3();
	window.addEventListener('storage', function(event){
		if (event.key == 'logout-event') { 
			window.location.href="#login";
		}
	});
} );
</script>
<script>
	var approvedMer = () =>
	{
		document.getElementById('twoa').disabled = true;
		document.getElementById('threea').disabled = false;
		document.getElementById('twoa').style.fontSize = '14.5px';
		document.getElementById('threea').style.fontSize = '13px';
		$('#dtBasicExampleAp').hide();
		$('.b').hide();
		var table = $('#dtBasicExample').DataTable( {
			"processing": true,
			"destroy": true,
			"oSearch": { "bSmart": false, "bRegex": true }
			} );
			table.clear().draw();
		$.ajax
			({
				async: true,
				type: "GET",
				url: urlForAll + "approved/merchant/approved",
				headers: 
				{
				  'Accept': 'application/json',
				  'Content-Type': 'application/json',
				"Authorization": 'Bearer ' + localStorage.getItem('token')
				},
				success: function(data) 
				{
					document.getElementById('twoa').innerHTML = 'Approved Merchants: ' + data.data.length;
					document.getElementById('threea').innerHTML = 'Unapproved Merchants';
					var trHTML = '';
					$.each(data.data, function (i, item) {
					var table_rows = '<tr><td>'
					+data.data[i].root_org_name+'</td><td>'
					+data.data[i].merchant_id+'</td><td>'
					+data.data[i].org_name+'</td><td>'
					+data.data[i].person_name+'</td><td>'
					+data.data[i].email+'</td><td>'
					+data.data[i].phone_number+'</td><td>'
					+'<button id="' + data.data[i].merchant_id + '" class="btn-round btn-outline btn enableEmail" style="font-size:13px">Enable</button>' + "</td><td>"
					+'<button id="' + data.data[i].merchant_id + '" class="btn-round btn-outline btn disableEmail" style="font-size:13px">Disable</button>' + "</td></tr>";
		
					table.rows.add($(table_rows)).draw();
					});
				},
				error: function(XMLHttpRequest, textStatus, errorThrown) {
					alert("Please wait, we are working!");
				}
			})
		$('.dataTables_filter input[type="search"]').
		attr('placeholder','Search anything!').
		css({'width':'220px','display':'inline-block','background':'white'});

		$('.dataTables_filter input[type="search"]').
		attr('class','btn btn-round').
		css({'width':'220px','display':'inline-block','color':'#000000','background':'#FFFFFA'});

		$('.dataTables_length select').
		attr('class','btn btn-round').
		css({'width':'80px','background-color':'white','color':'#000000','background':'#FFFFFA'});

		$('#dtBasicExample').show();
		$('.a').show();
	}
	
	var unApprovedMer = () => 
	{ 
		document.getElementById('twoa').disabled = false;
		document.getElementById('threea').disabled = true;
		document.getElementById('twoa').style.fontSize = '13px';
		document.getElementById('threea').style.fontSize = '14.5px';
		$('#dtBasicExample').hide();
		$('.a').hide();
		var table = $('#dtBasicExampleAp').DataTable( {
			"processing": true,
			"destroy": true,
			"oSearch": { "bSmart": false, "bRegex": true }
			} );
			table.clear().draw();
		$.ajax
			({
				async: true,
				type: "GET",
				url: urlForAll + "approved/merchant/unapproved",
				headers: 
				{
					'Accept': 'application/json',
					'Content-Type': 'application/json',
					"Authorization": 'Bearer ' + localStorage.getItem('token')
				},
				success: function(data) 
				{
					document.getElementById('twoa').innerHTML = 'Approved Merchants';
					document.getElementById('threea').innerHTML = 'Unapproved Merchants: ' + data.data.length;
					
					var trHTML = '';
					$.each(data.data, function (i, item) {
					var table_rows = '<tr><td>'
					+data.data[i].root_org_name+'</td><td>'
					+data.data[i].merchant_id+'</td><td>'
					+data.data[i].org_name+'</td><td>'
					+data.data[i].person_name+'</td><td>'
					+data.data[i].email+'</td><td>'
					+data.data[i].phone_number+'</td><td>'
					+data.data[i].business_filed+'</td><td>'
					+data.data[i].per_delivery_cost+'</td><td>'
					+'<button id="' + data.data[i].merchant_id + '" name="' + data.data[i].user_id + '" class="deleteIt btn-round btn-outline btn">Approve</button>'
					+'</td></tr>';
					table.rows.add($(table_rows)).draw();
					});
				},
				error: function(XMLHttpRequest, textStatus, errorThrown) {
					alert("Please wait, we are working!");
				}
			})
		$('.dataTables_filter input[type="search"]').
		attr('placeholder','Search anything!').
		css({'width':'220px','display':'inline-block','background':'white'});

		$('.dataTables_filter input[type="search"]').
		attr('class','btn btn-round').
		css({'width':'220px','display':'inline-block','color':'#000000','background':'#FFFFFA'});

		$('.dataTables_length select').
		attr('class','btn btn-round').
		css({'width':'80px','background-color':'white','color':'#000000','background':'#FFFFFA'});

		$('#dtBasicExampleAp').show();
		$('.b').show();
	};
	
	var merchant_id;
	var user_id;
	var $t;
	$('#dtBasicExampleAp').on('click', '.deleteIt', function () 
	{	
		merchant_id = $(this).attr('id');
		user_id = $(this).attr('name');
		$t = $(this);
		$('#tick').hide();
		$(".circle-loader").removeClass("load-complete");
	
		$("#sure").html("Are you sure?");
		$("#myModal").modal();
	});
	$('.btn-ok').click(function(){
	$("#sure").html("Please wait!");

	document.getElementById('modalCancel').disabled = true;
	document.getElementById('modalApprove').disabled = true;
	$.ajax
		({
			async: true,
			type: "GET",
			
			url: urlForAll + "approved/merchant/" + merchant_id + "/" + user_id,
			
			headers: 
			{
			  'Accept': 'application/json',
			  'Content-Type': 'application/json',
			  "Authorization": 'Bearer ' + localStorage.getItem('token')
			},
			success: function(data) 
			{
				setTimeout(function(){ 
					$(".circle-loader").addClass("load-complete");
					
					$('#tick').show(); 
				
					$("#sure").html("Merchant approved!");
				}, 900);
				
				setTimeout(function(){ 
					$("#myModal").modal('hide');
					var table = $('#dtBasicExampleAp').DataTable();
					
					table
					.row($t.parents('tr'))
					.remove()
					.draw(false);
					document.getElementById('threea').innerHTML = 'Unapproved Merchants: ' + table
																								.column( 0 )
																								.data()
																								.length;
					
					
						document.getElementById('modalCancel').disabled = false;
						document.getElementById('modalApprove').disabled = false;
					}, 2000);

			},
			error: function(XMLHttpRequest, textStatus, errorThrown) {
				
				document.getElementById('modalCancel').disabled = false;
				document.getElementById('modalApprove').disabled = false;
				$('#myModal').modal('hide');
				$('#myModal2').modal();
			}
		});
	});
</script>
